<!DOCTYPE html >
<!--
Generated by KokoroIO.XamarinForms.Scripts.exe
DO NOT EDIT THIS FILE DIRECTLY
-->
<html>
    <head>
        <meta charset="utf-8" />
        <base href="https://kokoro.io/" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
        <title>kokoro.io</title>
        <style>/*!
 * Bootstrap v3.3.7 (http://getbootstrap.com)
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */ /*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */

html {
    font-family: sans-serif;
    -ms-text-size-adjust: 100%;
    -webkit-text-size-adjust: 100%
}

a {
    background-color: transparent
}

    a:active, a:hover {
        outline: 0
    }

b, strong {
    font-weight: bold
}

h1 {
    font-size: 2em;
    margin: 0.67em 0
}

small {
    font-size: 80%
}

sub, sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline
}

sup {
    top: -0.5em
}

sub {
    bottom: -0.25em
}

img {
    border: 0
}

hr {
    box-sizing: content-box;
    height: 0
}

pre {
    overflow: auto
}

code, kbd, pre, samp {
    font-family: monospace, monospace;
    font-size: 1em
}

/*! Source: https://github.com/h5bp/html5-boilerplate/blob/master/src/css/main.css */

html {
    font-size: 10px;
    -webkit-tap-highlight-color: transparent
}

body {
    font-family: "Lato","Helvetica Neue",Helvetica,Arial,sans-serif;
    font-size: 15px;
    line-height: 1.42857;
    color: #2C3E50;
    background-color: #fff
}

a {
    color: #18BC9C;
    text-decoration: none
}

    a:hover, a:focus {
        color: #18BC9C;
        text-decoration: underline
    }

    a:focus {
        outline: 5px auto -webkit-focus-ring-color;
        outline-offset: -2px
    }

img {
    vertical-align: middle
}

.img-responsive {
    display: block;
    max-width: 100%;
    height: auto
}

.img-rounded {
    border-radius: 6px
}

.img-thumbnail {
    padding: 4px;
    line-height: 1.42857;
    background-color: #fff;
    border: 1px solid #ecf0f1;
    border-radius: 4px;
    -webkit-transition: all 0.2s ease-in-out;
    -o-transition: all 0.2s ease-in-out;
    transition: all 0.2s ease-in-out;
    display: inline-block;
    max-width: 100%;
    height: auto
}

h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
    font-family: "Lato","Helvetica Neue",Helvetica,Arial,sans-serif;
    font-weight: 400;
    line-height: 1.1;
    color: inherit
}

    h1 small, h1 .small, h2 small, h2 .small, h3 small, h3 .small, h4 small, h4 .small, h5 small, h5 .small, h6 small, h6 .small, .h1 small, .h1 .small, .h2 small, .h2 .small, .h3 small, .h3 .small, .h4 small, .h4 .small, .h5 small, .h5 .small, .h6 small, .h6 .small {
        font-weight: normal;
        line-height: 1;
        color: #b4bcc2
    }

h4, .h4, h5, .h5, h6, .h6 {
    margin-top: 10.5px;
    margin-bottom: 10.5px
}

    h4 small, h4 .small, .h4 small, .h4 .small, h5 small, h5 .small, .h5 small, .h5 .small, h6 small, h6 .small, .h6 small, .h6 .small {
        font-size: 75%
    }

h1, .h1 {
    font-size: 39px
}

h2, .h2 {
    font-size: 32px
}

h3, .h3 {
    font-size: 26px
}

h4, .h4 {
    font-size: 19px
}

h5, .h5 {
    font-size: 15px
}

h6, .h6 {
    font-size: 13px
}

p {
    margin: 0 0 10.5px
}

small, .small {
    font-size: 86%
}

.text-muted {
    color: #b4bcc2
}

ul, ol {
    margin-top: 0;
    margin-bottom: 10.5px
}

    ul ul, ul ol, ol ul, ol ol {
        margin-bottom: 0
    }

blockquote {
    padding: 10.5px 21px;
    margin: 0 0 21px;
    font-size: 18.75px;
    border-left: 5px solid #ecf0f1
}

    blockquote p:last-child, blockquote ul:last-child, blockquote ol:last-child {
        margin-bottom: 0
    }

    blockquote footer, blockquote small, blockquote .small {
        display: block;
        font-size: 80%;
        line-height: 1.42857;
        color: #b4bcc2
    }

        blockquote footer:before, blockquote small:before, blockquote .small:before {
            content: '\2014 \00A0'
        }

code, kbd, pre, samp {
    font-family: Menlo,Monaco,Consolas,"Courier New",monospace
}

code {
    padding: 2px 4px;
    font-size: 90%;
    color: #c7254e;
    background-color: #f9f2f4;
    border-radius: 4px
}

kbd {
    padding: 2px 4px;
    font-size: 90%;
    color: #fff;
    background-color: #333;
    border-radius: 3px;
    box-shadow: inset 0 -1px 0 rgba(0,0,0,0.25)
}

    kbd kbd {
        padding: 0;
        font-size: 100%;
        font-weight: bold;
        box-shadow: none
    }

pre {
    display: block;
    padding: 10px;
    margin: 0 0 10.5px;
    font-size: 14px;
    line-height: 1.42857;
    word-break: break-all;
    word-wrap: break-word;
    color: #7b8a8b;
    background-color: #ecf0f1;
    border: 1px solid #ccc;
    border-radius: 4px
}

    pre code {
        padding: 0;
        font-size: inherit;
        color: inherit;
        white-space: pre-wrap;
        background-color: transparent;
        border-radius: 0
    }

.label-default {
    background-color: #95a5a6;
}

.label {
    display: inline;
    padding: .2em .6em .3em;
    font-size: 75%;
    font-weight: bold;
    line-height: 1;
    color: #fff;
    text-align: center;
    white-space: nowrap;
    vertical-align: baseline;
    border-radius: .25em;
}p {
    margin: 0;
}

img.thumb {
    max-width: 330px;
    max-height: 300px;
}

.message blockquote {
    padding: 3px 8px;
    margin: 3px 0 10px 0;
    border-left: 4px solid #18BC9C;
    font-size: 1em;
    line-height: 1.4em;
}

.embed_contents .embed_media.nsfw img,
.embed_contents .embed-thumbnail.nsfw img {
    filter: grayscale(90%) blur(4px);
}

.embed_contents .thumb .embed-thumbnail {
    overflow: hidden;
    position: relative;
    border-radius: 6px;
}

.embed_content {
    margin: 10px 0;
}

.embed_contents .nsfw-mark {
    color: #F39C12;
    position: absolute;
    top: 5px;
    left: 5px;
    text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff, -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;
}

.embed_content .medias > .embed_media {
    position: relative;
    align-items: stretch;
    overflow: hidden;
    border-radius: 6px;
}

.embed_content > .embed-mixedcontent .medias > .embed_media {
    margin: 10px 10px 0 0;
}

.embed_content .medias {
    display: flex;
    flex-flow: row wrap;
}

.embed_content > .embed-mixedcontent .medias {
    padding: 0px 10px 10px 10px;
    margin: -10px 0 0 0;
}

.embed_contents .play-button {
    color: #000;
    opacity: 0.7;
    position: absolute;
    top: 50%;
    left: 50%;
    margin: -0.5em 0 0 -0.5em;
    text-shadow: 0 2px 0 #fff, 2px 0 0 #fff, 0 -2px 0 #fff, -2px 0 0 #fff, -2px -2px 0 #fff, 2px -2px 0 #fff, -2px 2px 0 #fff, 2px 2px 0 #fff;
}

.embed_content > .embed-singleimage .embed_media img,
.embed_content > .embed-singlevideo .embed_media img {
    max-width: 250px;
    max-height: 250px;
}

.embed_content > .embed-singleaudio .embed_media .embed-audio {
    border-radius: 6px;
    padding: 2px;
    border: 1px solid #ccc;
    line-height: 1;
    background: #fafafa;
}

.embed_content > .embed-mixedcontent {
    border: 1px solid #ccc;
    border-radius: 5px;
}

    .embed_content > .embed-mixedcontent > .meta {
        display: flex;
        flex-flow: row nowrap;
        padding: 10px;
    }

        .embed_content > .embed-mixedcontent > .meta > .info {
            min-width: 0; /* Hack for enable word breaking at flexbox */
        }

        .embed_content > .embed-mixedcontent > .meta .description p {
            white-space: pre-wrap;
        }

        .embed_content > .embed-mixedcontent > .meta > .thumb {
            margin: 0 10px 0 0;
        }

            .embed_content > .embed-mixedcontent > .meta > .thumb img {
                display: block;
            }

            .embed_content > .embed-mixedcontent > .meta > .thumb img {
                max-width: 120px;
                max-height: 120px;
            }

    .embed_content > .embed-mixedcontent > .medias {
        justify-content: center;
    }

        .embed_content > .embed-mixedcontent > .medias > .embed_media img {
            max-width: 120px;
        }

        .embed_content > .embed-mixedcontent > .medias > .embed_media img {
            display: block;
        }

    .embed_content > .embed-mixedcontent > a {
        display: none;
    }

.ne-image-wrapper img {
    max-width: 330px;
    max-height: 300px;
}

.talk {
    display: flex;
    flex-direction: row;
}

    .talk.continued {
        padding-top: 4px;
    }

    .talk.not-continued {
        padding-top: 13px;
    }

    .talk .avatar {
        display: flex;
        flex-grow: 0;
        min-width: 40px;
        padding: 0 10px;
        /* position: relative; */
    }

        .talk .avatar img {
            width: 40px;
            height: 40px;
            display: block;
            position: relative;
        }

            .talk .avatar img:before {
                content: " ";
                width: 40px;
                height: 40px;
                display: block;
                position: absolute;
                top: 0px;
                left: 0px;
                background: #fff;
            }

            .talk .avatar img:after {
                content: "\00a0(^_^;)";
                font-size: 0.7em;
                color: #666666;
                text-align: center;
                line-height: 40px;
                width: 40px;
                height: 40px;
                display: block;
                position: absolute;
                top: 0px;
                left: 0px;
                background: #eee;
                border-radius: 5px;
            }

    .talk .message {
        flex-grow: 1;
        min-width: 0; /* Hack for enable word breaking at flexbox */
        word-wrap: break-word;
        overflow-wrap: break-word;
        padding: 0 10px 0 0;
    }

        .talk .message .speaker {
            font-weight: bold;
            font-size: 0.9em;
        }

            .talk .message .speaker a {
                text-decoration: none;
                color: #2C3E50;
            }

                .talk .message .speaker a:hover {
                    color: #18BC9C;
                }

        .talk .message .filtered_text {
            font-size: 1.1em;
        }

            .talk .message .filtered_text p {
                white-space: pre-wrap;
            }

        .talk .message .deleted_text {
            font-size: 1.1em;
            color: #aaa;
        }

        .talk .message .timeleft {
            padding-left: 5px;
        }.highlight table td {
    padding: 5px
}

.highlight table pre {
    margin: 0
}

.highlight .cm {
    color: #999988;
    font-style: italic
}

.highlight .cp {
    color: #999999;
    font-weight: bold
}

.highlight .c1 {
    color: #999988;
    font-style: italic
}

.highlight .cs {
    color: #999999;
    font-weight: bold;
    font-style: italic
}

.highlight .c, .highlight .cd {
    color: #999988;
    font-style: italic
}

.highlight .err {
    color: #a61717;
    background-color: #e3d2d2
}

.highlight .gd {
    color: #000000;
    background-color: #ffdddd
}

.highlight .ge {
    color: #000000;
    font-style: italic
}

.highlight .gr {
    color: #aa0000
}

.highlight .gh {
    color: #999999
}

.highlight .gi {
    color: #000000;
    background-color: #ddffdd
}

.highlight .go {
    color: #888888
}

.highlight .gp {
    color: #555555
}

.highlight .gs {
    font-weight: bold
}

.highlight .gu {
    color: #aaaaaa
}

.highlight .gt {
    color: #aa0000
}

.highlight .kc {
    color: #000000;
    font-weight: bold
}

.highlight .kd {
    color: #000000;
    font-weight: bold
}

.highlight .kn {
    color: #000000;
    font-weight: bold
}

.highlight .kp {
    color: #000000;
    font-weight: bold
}

.highlight .kr {
    color: #000000;
    font-weight: bold
}

.highlight .kt {
    color: #445588;
    font-weight: bold
}

.highlight .k, .highlight .kv {
    color: #000000;
    font-weight: bold
}

.highlight .mf {
    color: #009999
}

.highlight .mh {
    color: #009999
}

.highlight .il {
    color: #009999
}

.highlight .mi {
    color: #009999
}

.highlight .mo {
    color: #009999
}

.highlight .m, .highlight .mb, .highlight .mx {
    color: #009999
}

.highlight .sb {
    color: #d14
}

.highlight .sc {
    color: #d14
}

.highlight .sd {
    color: #d14
}

.highlight .s2 {
    color: #d14
}

.highlight .se {
    color: #d14
}

.highlight .sh {
    color: #d14
}

.highlight .si {
    color: #d14
}

.highlight .sx {
    color: #d14
}

.highlight .sr {
    color: #009926
}

.highlight .s1 {
    color: #d14
}

.highlight .ss {
    color: #990073
}

.highlight .s {
    color: #d14
}

.highlight .na {
    color: #008080
}

.highlight .bp {
    color: #999999
}

.highlight .nb {
    color: #0086B3
}

.highlight .nc {
    color: #445588;
    font-weight: bold
}

.highlight .no {
    color: #008080
}

.highlight .nd {
    color: #3c5d5d;
    font-weight: bold
}

.highlight .ni {
    color: #800080
}

.highlight .ne {
    color: #990000;
    font-weight: bold
}

.highlight .nf {
    color: #990000;
    font-weight: bold
}

.highlight .nl {
    color: #990000;
    font-weight: bold
}

.highlight .nn {
    color: #555555
}

.highlight .nt {
    color: #000080
}

.highlight .vc {
    color: #008080
}

.highlight .vg {
    color: #008080
}

.highlight .vi {
    color: #008080
}

.highlight .nv {
    color: #008080
}

.highlight .ow {
    color: #000000;
    font-weight: bold
}

.highlight .o {
    color: #000000;
    font-weight: bold
}

.highlight .w {
    color: #bbbbbb
}

.highlight {
    background-color: #f8f8f8
}
/* Defines KokoroIO.XamarinForms' orignal styles */
html,
body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  -ms-content-zooming: none;
}
body {
  overflow-x: hidden;
  overflow-y: auto;
  font-family: sans-serif;
}
.talk.continued .avatar img {
  display: none;
}
.talk.continued .speaker {
  display: none;
}
.talk .avatar {
  max-height: 40px;
}
.talk .avatar img {
  border-radius: 5px;
}
.talk.continued.hidden,
.talk.not-continued.hidden {
  padding-top: 0;
}
.talk.hidden > div {
  display: none !important;
}
.talk:last-child {
  margin-bottom: 10px;
}
.talk {
  position: relative;
}
.talk > .message-menu {
  display: none;
}
.talk.message-hover,
.talk:hover {
  background-color: #f8f8f8;
}
.talk.message-hover > .message-menu,
.talk:hover > .message-menu {
  display: flex;
  flex-flow: row nowrap;
  position: absolute;
  width: 96px;
  height: 32px;
  top: -32px;
  right: 32px;
  line-height: 32px;
  z-index: 100;
  text-align: center;
}
.talk.message-hover > .message-menu > a,
.talk:hover > .message-menu > a {
  width: 32px;
  height: 32px;
  box-sizing: border-box;
  border: 1px solid #ccc;
  background-color: #fff;
  border-left-color: #fff;
}
.talk.message-hover > .message-menu > a:first-child,
.talk:hover > .message-menu > a:first-child {
  border-top-left-radius: 4px;
  border-bottom-left-radius: 4px;
  border-left-color: #ccc;
}
.talk.message-hover > .message-menu > a:last-child,
.talk:hover > .message-menu > a:last-child {
  border-top-right-radius: 4px;
  border-bottom-right-radius: 4px;
}
.talk.message-hover > .message-menu > a .fa,
.talk:hover > .message-menu > a .fa {
  width: 18px;
  height: 18px;
}
.talk.message-hover > .message-menu > a.disabled .fa,
.talk:hover > .message-menu > a.disabled .fa {
  opacity: 0.5;
}
.talk.message-hover:first-child > .message-menu,
.talk:hover:first-child > .message-menu {
  top: 0;
}
html.html-phone .talk > .message-menu {
  display: block;
  position: absolute;
  width: 24px;
  height: 24px;
  top: 0;
  right: 0;
  line-height: 24px;
  text-align: center;
  opacity: 0.1;
}
html.html-phone .talk > .message-menu > a {
  width: 24px;
  height: 24px;
  box-sizing: border-box;
  border-width: 0;
  border-radius: 0;
  background-color: transparent;
}
html.html-phone .talk > .message-menu > a .fa {
  width: 24px;
  height: 24px;
}
html.html-phone .talk.message-hover,
html.html-phone .talk:hover {
  background-color: none;
}
html.html-phone .talk.message-hover > .message-menu,
html.html-phone .talk:hover > .message-menu {
  opacity: 0.8;
}
html.html-phone .talk .embed_content > .embed-mixedcontent {
  margin-left: -50px;
}
html.html-phone .talk .embed_content > .embed-mixedcontent .meta {
  display: block;
}
html.html-phone .talk .embed_content > .embed-mixedcontent .meta > .thumb {
  float: left;
}
html.html-phone .talk .embed_content > .embed-mixedcontent .meta > *:last-child::after {
  content: "";
  display: block;
  height: 0;
  clear: left;
}
.fa {
  display: inline-block;
  box-sizing: border-box;
  width: 14px;
  height: 14px;
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
}
.fa-reply {
  background-image: url(data:image/svg+xml,%3Csvg%20fill%3D%22%23000000%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20width%3D%2224%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0D%0A%20%20%20%20%3Cpath%20d%3D%22M10%209V5l-7%207%207%207v-4.1c5%200%208.5%201.6%2011%205.1-1-5-4-10-11-11z%22%2F%3E%0D%0A%20%20%20%20%3Cpath%20d%3D%22M0%200h24v24H0z%22%20fill%3D%22none%22%2F%3E%0D%0A%3C%2Fsvg%3E);
}
.fa-clipboard {
  background-image: url(data:image/svg+xml,%3Csvg%20fill%3D%22%23000000%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20width%3D%2224%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0D%0A%20%20%20%20%3Cpath%20d%3D%22M0%200h24v24H0z%22%20fill%3D%22none%22%2F%3E%0D%0A%20%20%20%20%3Cpath%20d%3D%22M16%201H4c-1.1%200-2%20.9-2%202v14h2V3h12V1zm3%204H8c-1.1%200-2%20.9-2%202v14c0%201.1.9%202%202%202h11c1.1%200%202-.9%202-2V7c0-1.1-.9-2-2-2zm0%2016H8V7h11v14z%22%2F%3E%0D%0A%3C%2Fsvg%3E);
}
.fa-trash {
  background-image: url(data:image/svg+xml,%3Csvg%20fill%3D%22%23000000%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20width%3D%2224%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0D%0A%20%20%20%20%3Cpath%20d%3D%22M6%2019c0%201.1.9%202%202%202h8c1.1%200%202-.9%202-2V7H6v12zM19%204h-3.5l-1-1h-5l-1%201H5v2h14V4z%22%2F%3E%0D%0A%20%20%20%20%3Cpath%20d%3D%22M0%200h24v24H0z%22%20fill%3D%22none%22%2F%3E%0D%0A%3C%2Fsvg%3E);
}
.fa-chevron-down {
  background-image: url(data:image/svg+xml,%3Csvg%20fill%3D%22%23000000%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20width%3D%2224%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0D%0A%20%20%20%20%3Cpath%20d%3D%22M16.59%208.59L12%2013.17%207.41%208.59%206%2010l6%206%206-6z%22%2F%3E%0D%0A%20%20%20%20%3Cpath%20d%3D%22M0%200h24v24H0z%22%20fill%3D%22none%22%2F%3E%0D%0A%3C%2Fsvg%3E);
}
.fa-exclamation-triangle {
  background-image: url(data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22utf-8%22%3F%3E%0D%0A%3Csvg%20fill%3D%22%23f39c12%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20width%3D%2224%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0D%0A%20%20%3Cpath%20d%3D%22M0%200h24v24H0z%22%20fill%3D%22none%22%20%2F%3E%0D%0A%20%20%3Cpath%20d%3D%22M1%2021h22L12%202%201%2021zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z%22%20%2F%3E%0D%0A%3C%2Fsvg%3E);
}
.talk .message .filtered_text img {
  max-width: 100%;
  border-radius: 5px;
}
@media (min-width: 600px) {
  .talk .message .filtered_text img {
    max-width: 540px;
  }
}
.html-phone *,
.html-tablet * {
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
}</style>
        <script>var Messages;
(function (Messages) {
    Messages.IS_BOTTOM_MARGIN = 15;
    Messages.IS_TOP_MARGIN = 4;
    Messages.LOAD_OLDER_MARGIN = 300;
    Messages.LOAD_NEWER_MARGIN = 300;
    Messages.HIDE_CONTENT_MARGIN = 60;
    Messages.LOG_VIEWPORT = false;
    Messages.IS_DESKTOP = document.documentElement.classList.contains("html-desktop");
    Messages.IS_TABLET = document.documentElement.classList.contains("html-tablet");
    if (!Messages.IS_DESKTOP && !Messages.IS_TABLET) {
        document.documentElement.classList.add("html-phone");
    }
})(Messages || (Messages = {}));
var Messages;
(function (Messages) {
    function _padLeft(i, l) {
        var offset = l == 1 ? 10 : l == 2 ? 100 : Math.pow(10, l);
        if (i > offset) {
            var s = i.toFixed(0);
            return s.substr(s.length - l, l);
        }
        return (i + offset).toFixed(0).substr(1, l);
    }
    function _createFAAnchor(url, faClass, disabled) {
        var a = document.createElement("a");
        if (disabled) {
            a.href = "javascript:void(0)";
            a.classList.add("disabled");
        }
        else {
            a.href = url;
        }
        a.appendChild(_createFA(faClass));
        return a;
    }
    function _createFA(className) {
        var r = document.createElement("i");
        r.classList.add("fa");
        r.classList.add(className);
        return r;
    }
    function createTaklElement(m) {
        var id = m.Id;
        var talk = document.createElement("div");
        talk.classList.add("talk");
        talk.classList.add(m.IsMerged ? "continued" : "not-continued");
        if (id) {
            talk.id = "talk" + id;
            talk.setAttribute("data-message-id", id.toString());
            if (!m.IsDeleted) {
                if (Messages.IS_DESKTOP || Messages.IS_TABLET) {
                    var control = document.createElement("div");
                    control.classList.add("message-menu");
                    control.appendChild(_createFAAnchor("http://kokoro.io/client/control?event=replyToMessage&id=" + m.Id, "fa-reply"));
                    control.appendChild(_createFAAnchor("http://kokoro.io/client/control?event=copyMessage&id=" + m.Id, "fa-clipboard"));
                    control.appendChild(_createFAAnchor("http://kokoro.io/client/control?event=deleteMessage&id=" + m.Id, "fa-trash", !m.CanDelete));
                    talk.appendChild(control);
                }
                else {
                    var control = document.createElement("div");
                    control.classList.add("message-menu");
                    control.appendChild(_createFAAnchor("http://kokoro.io/client/control?event=messageMenu&id=" + m.Id, "fa-chevron-down"));
                    talk.appendChild(control);
                }
            }
        }
        else {
            var idempotentKey = m.IdempotentKey;
            if (idempotentKey) {
                talk.setAttribute("data-idempotent-key", idempotentKey);
            }
        }
        try {
            var avatar = document.createElement("div");
            avatar.classList.add("avatar");
            talk.appendChild(avatar);
            var profUrl = "https://kokoro.io/profiles/" + m.ProfileId;
            var imgLink = document.createElement("a");
            imgLink.href = profUrl;
            imgLink.classList.add("img-rounded");
            avatar.appendChild(imgLink);
            var img = document.createElement("img");
            img.src = m.Avatar;
            imgLink.appendChild(img);
            var message = document.createElement("div");
            message.classList.add("message");
            talk.appendChild(message);
            var speaker = document.createElement("div");
            speaker.classList.add("speaker");
            message.appendChild(speaker);
            var name = document.createElement("a");
            name.innerText = m.DisplayName;
            name.href = profUrl;
            speaker.appendChild(name);
            if (m.IsBot) {
                var small = document.createElement("small");
                small.className = "label label-default";
                small.innerText = "bot";
                speaker.appendChild(small);
            }
            var small = document.createElement("small");
            small.classList.add("timeleft", "text-muted");
            if (m.PublishedAt) {
                try {
                    var d = new Date(Date.parse(m.PublishedAt));
                    small.innerText = (d.getFullYear() == new Date().getFullYear() ? '' : _padLeft(d.getFullYear(), 4) + '/')
                        + _padLeft(d.getMonth() + 1, 2)
                        + '/' + _padLeft(d.getDate(), 2)
                        + ' ' + _padLeft(d.getHours(), 2)
                        + ':' + _padLeft(d.getMinutes(), 2);
                    small.title = _padLeft(d.getFullYear(), 4)
                        + '/' + _padLeft(d.getMonth() + 1, 2)
                        + '/' + _padLeft(d.getDate(), 2)
                        + ' ' + _padLeft(d.getHours(), 2)
                        + ':' + _padLeft(d.getMinutes(), 2)
                        + ':' + _padLeft(d.getSeconds(), 2);
                }
                catch (ex) {
                    small.innerText = m.PublishedAt;
                }
            }
            else {
                small.innerText = "Now sending...";
            }
            speaker.appendChild(small);
            var filteredText = document.createElement("div");
            filteredText.classList.add(m.IsDeleted ? "deleted_text" : "filtered_text");
            filteredText.innerHTML = m.HtmlContent;
            message.appendChild(filteredText);
            if (m.EmbedContents && m.EmbedContents.length > 0) {
                var ecs = document.createElement("div");
                ecs.classList.add("embed_contents");
                message.appendChild(ecs);
                var d = void 0;
                try {
                    for (var i = 0; i < m.EmbedContents.length; i++) {
                        var e = m.EmbedContents[i];
                        if (!e) {
                            continue;
                        }
                        d = e.data;
                        if (!d) {
                            continue;
                        }
                        var ec = document.createElement("div");
                        ec.classList.add("embed_content");
                        ecs.appendChild(ec);
                        switch (d.type) {
                            case 'MixedContent':
                                ec.appendChild(_createEmbedContent(m, d, false));
                                break;
                            case 'SingleImage':
                            case 'SingleVideo':
                            case 'SingleAudio':
                                ec.appendChild(_createEmbedContent(m, d, true));
                                break;
                            default:
                                console.warn("Unknown embed data: ", d);
                                break;
                        }
                    }
                }
                catch (ex) {
                    ecs.innerHTML = "";
                    var err = document.createElement('p');
                    err.innerText = ex;
                    ecs.appendChild(err);
                    var json = document.createElement('pre');
                    json.innerText = JSON.stringify(d);
                    ecs.appendChild(json);
                }
            }
        }
        catch (ex) {
            talk.innerText = ex;
        }
        return talk;
    }
    Messages.createTaklElement = createTaklElement;
    function _createEmbedContent(message, d, hideInfo) {
        var r = document.createElement("div");
        r.classList.add("embed-" + d.type.toLowerCase());
        if (!hideInfo) {
            var meta = document.createElement("div");
            meta.classList.add("meta");
            r.appendChild(meta);
            if (d.metadata_image) {
                var m = d.metadata_image;
                var thd = _createMediaDiv(m, d, message, "embed-thumbnail");
                if (thd) {
                    var thumb = document.createElement("div");
                    thumb.classList.add("thumb");
                    meta.appendChild(thumb);
                    thumb.appendChild(thd);
                }
            }
            var info = document.createElement("div");
            info.classList.add("info");
            meta.appendChild(info);
            if (d.title) {
                var titleDiv = document.createElement("div");
                titleDiv.classList.add("title");
                info.appendChild(titleDiv);
                var titleLink = document.createElement("a");
                titleLink.href = d.url;
                titleDiv.appendChild(titleLink);
                var title = document.createElement("strong");
                title.innerText = d.title;
                titleLink.appendChild(title);
            }
            if (d.description) {
                var descriptionDiv = document.createElement("div");
                descriptionDiv.classList.add("description");
                info.appendChild(descriptionDiv);
                var description = document.createElement("p");
                var re = /(https?:\/\/[a-z0-9]+(?:[-.][a-z0-9]+)*(?:\/|[!$&-;=?-Z\\^_a-~]|%[A-F0-9]{2})*)/;
                var ary = d.description.split(re);
                if (ary && ary.length > 1) {
                    for (var i_1 = 0; i_1 < ary.length; i_1++) {
                        var t = ary[i_1];
                        if (i_1 % 2 == 0) {
                            description.appendChild(document.createTextNode(t));
                        }
                        else {
                            var a = document.createElement("a");
                            a.setAttribute("href", t);
                            a.appendChild(document.createTextNode(t));
                            description.appendChild(a);
                        }
                    }
                }
                else {
                    description.innerText = d.description;
                }
                descriptionDiv.appendChild(description);
            }
        }
        if (d.medias && d.medias.length > 0) {
            var medias = document.createElement("div");
            medias.classList.add("medias");
            for (var i = 0; i < d.medias.length; i++) {
                var m = d.medias[i];
                if (m) {
                    var md = _createMediaDiv(m, d, message);
                    if (md) {
                        medias.appendChild(md);
                    }
                }
            }
            if (medias.children.length > 0) {
                r.appendChild(medias);
            }
        }
        return r;
    }
    function _createMediaDiv(media, data, message, className) {
        var tu = (media.thumbnail ? media.thumbnail.url : null) || media.raw_url;
        if (!tu) {
            return null;
        }
        var em = document.createElement("div");
        em.classList.add(className || "embed_media");
        var a = document.createElement("a");
        a.href = media.location || media.raw_url || data.url;
        em.appendChild(a);
        var img = document.createElement("img");
        img.classList.add("img-rounded");
        img.src = tu;
        a.appendChild(img);
        var policies = [(message.IsNsfw ? "Restricted" : "Unknown"), media.restriction_policy, data.restriction_policy];
        if (policies.filter(function (p) { return p !== "Unknown"; })[0] === "Restricted") {
            em.classList.add("nsfw");
            var i = document.createElement("i");
            i.className = "nsfw-mark fa fa-exclamation-triangle";
            em.appendChild(i);
        }
        return em;
    }
})(Messages || (Messages = {}));
var Messages;
(function (Messages) {
    var _hasUnread = false;
    var _isUpdating = false;
    function HOST() {
        return document.body;
    }
    window.setHasUnread = function (value) {
        _hasUnread = !!value;
    };
    window.setMessages = function (messages) {
        _isUpdating = true;
        try {
            var b = HOST();
            console.debug("Setting " + (messages ? messages.length : 0) + " messages");
            b.innerHTML = "";
            _addMessagessCore(messages, null, false);
            b.scrollTop = b.scrollHeight - b.clientHeight;
            _reportVisibilities();
        }
        finally {
            _isUpdating = false;
        }
    };
    window.addMessages = function (messages, merged, showNewMessage) {
        _isUpdating = true;
        try {
            var b = HOST();
            console.debug("Adding " + (messages ? messages.length : 0) + " messages");
            var isEmpty = b.children.length === 0;
            showNewMessage = showNewMessage && !isEmpty;
            _addMessagessCore(messages, merged, !showNewMessage && !isEmpty);
            if (isEmpty) {
                b.scrollTop = b.scrollHeight - b.clientHeight;
            }
            else if (showNewMessage && messages && messages.length > 0) {
                var minId = Number.MAX_VALUE;
                messages.forEach(function (v) { return minId = Math.min(minId, v.Id); });
                var talk = document.getElementById("talk" + minId);
                if (talk) {
                    _bringToTop(talk);
                }
            }
            _reportVisibilities();
        }
        finally {
            _isUpdating = false;
        }
    };
    var removeMessages = window.removeMessages = function (ids, idempotentKeys, merged) {
        _isUpdating = true;
        try {
            console.debug("Removing " + ((ids ? ids.length : 0) + (idempotentKeys ? idempotentKeys.length : 0)) + " messages");
            var b = HOST();
            if (ids) {
                for (var i = 0; i < ids.length; i++) {
                    var talk = document.getElementById('talk' + ids[i]);
                    if (talk) {
                        var nt = talk.offsetTop < b.scrollTop ? b.scrollTop - talk.clientHeight : b.scrollTop;
                        talk.remove();
                        b.scrollTop = nt;
                    }
                }
            }
            if (idempotentKeys) {
                for (var i_2 = 0; i_2 < idempotentKeys.length; i_2++) {
                    var talk_1 = _talkByIdempotentKey(idempotentKeys[i_2]);
                    if (talk_1) {
                        var nt = talk_1.offsetTop < b.scrollTop ? b.scrollTop - talk_1.clientHeight : b.scrollTop;
                        talk_1.remove();
                        b.scrollTop = nt;
                    }
                }
            }
            updateContinued(merged, true);
            _reportVisibilities();
        }
        finally {
            _isUpdating = false;
        }
    };
    function _addMessagessCore(messages, merged, scroll) {
        var b = HOST();
        var lastTalk = scroll && b.scrollTop + b.clientHeight + Messages.IS_BOTTOM_MARGIN > b.scrollHeight ? b.lastElementChild : null;
        scroll = scroll && !lastTalk;
        if (messages) {
            var j = 0;
            for (var i = 0; i < messages.length; i++) {
                var m = messages[i];
                var id = m.Id;
                if (!id) {
                    var talk = Messages.createTaklElement(m);
                    b.appendChild(talk);
                    _afterTalkInserted(talk);
                    continue;
                }
                else {
                    var cur = document.getElementById("talk" + id)
                        || (m.IdempotentKey ? _talkByIdempotentKey(m.IdempotentKey) : null);
                    if (cur) {
                        var shoudScroll = scroll && cur.offsetTop + cur.clientHeight - Messages.IS_TOP_MARGIN < b.scrollTop;
                        var st = b.scrollTop - cur.clientHeight;
                        var talk = Messages.createTaklElement(m);
                        b.insertBefore(talk, cur);
                        _afterTalkInserted(talk, cur.clientHeight);
                        cur.remove();
                        if (scroll) {
                            b.scrollTop = st + talk.clientHeight;
                        }
                        continue;
                    }
                }
                for (;;) {
                    var prev = b.children[j];
                    var aft = b.children[j + 1];
                    var pid = prev ? parseInt(prev.getAttribute("data-message-id"), 10) : -1;
                    var aid = aft ? parseInt(aft.getAttribute("data-message-id"), 10) : Number.MAX_VALUE;
                    if (!prev || (id != pid && !aft)) {
                        var talk = Messages.createTaklElement(m);
                        b.appendChild(talk);
                        _afterTalkInserted(talk);
                        j++;
                        break;
                    }
                    else if (id <= pid) {
                        var talk = Messages.createTaklElement(m);
                        if (id == pid) {
                            var shoudScroll = scroll && aft && aft.offsetTop - Messages.IS_TOP_MARGIN < b.scrollTop;
                            var st = b.scrollTop - prev.clientHeight;
                            b.insertBefore(talk, prev);
                            _afterTalkInserted(talk, prev.clientHeight);
                            prev.remove();
                            if (scroll) {
                                b.scrollTop = st + talk.clientHeight;
                            }
                        }
                        else {
                            _insertBefore(talk, prev, scroll);
                            j++;
                        }
                        break;
                    }
                    else if (id < aid) {
                        var talk = Messages.createTaklElement(m);
                        _insertBefore(talk, aft, scroll);
                        j++;
                        break;
                    }
                    else {
                        j++;
                    }
                }
            }
        }
        updateContinued(merged, scroll);
        if (lastTalk) {
            _bringToTop(lastTalk);
        }
    }
    window.showMessage = function (id, toTop) {
        _isUpdating = true;
        try {
            console.debug("showing message[" + id + "]");
            var talk = document.getElementById("talk" + id);
            if (talk) {
                var b = HOST();
                console.log("current scrollTo is " + b.scrollTop + ", and offsetTop is " + talk.offsetTop);
                if (talk.offsetTop < b.scrollTop || toTop) {
                    console.log("scrolling to " + talk.offsetTop);
                    b.scrollTop = talk.offsetTop;
                }
                else if (b.scrollTop + b.clientHeight < talk.offsetTop - talk.clientHeight) {
                    console.log("scrolling to " + (talk.offsetTop - b.clientHeight));
                    b.scrollTop = talk.offsetTop - b.clientHeight;
                }
            }
        }
        finally {
            _isUpdating = false;
        }
    };
    function updateContinued(merged, scroll) {
        if (merged) {
            var b = HOST();
            for (var i = 0; i < merged.length; i++) {
                var m = merged[i];
                var id = m.Id;
                var isMerged = m.IsMerged;
                var talk = document.getElementById('talk' + id);
                if (talk) {
                    var shouldScroll = scroll && talk.offsetTop - Messages.IS_TOP_MARGIN < b.scrollTop;
                    var bt = b.scrollTop - talk.clientHeight;
                    talk.classList.remove(!isMerged ? "continued" : "not-continued");
                    talk.classList.add(isMerged ? "continued" : "not-continued");
                    if (shouldScroll) {
                        b.scrollTop = bt + talk.clientHeight;
                    }
                }
            }
        }
    }
    function _insertBefore(talk, aft, scroll) {
        var b = HOST();
        scroll = scroll && aft.offsetTop - Messages.IS_TOP_MARGIN < b.scrollTop;
        var st = b.scrollTop;
        b.insertBefore(talk, aft);
        _afterTalkInserted(talk);
        if (scroll) {
            b.scrollTop = st + talk.clientHeight;
        }
    }
    function _bringToTop(talk) {
        if (talk) {
            if (talk.offsetTop === 0) {
                if (talk.previousElementSibling) {
                    setTimeout(function () {
                        var b = HOST();
                        b.scrollTop = talk.offsetTop;
                    }, 1);
                }
            }
            else {
                var b = HOST();
                b.scrollTop = talk.offsetTop;
            }
        }
    }
    function _afterTalkInserted(talk, previousHeight) {
        var b = HOST();
        if (talk.offsetTop < b.scrollTop) {
            var delta = talk.clientHeight - (previousHeight || 0);
            if (delta != 0) {
                b.scrollTop += delta;
                console.log("scolled " + delta);
            }
        }
        talk.setAttribute("data-height", talk.clientHeight.toString());
        var anchors = talk.getElementsByTagName("a");
        for (var i = 0; i < anchors.length; i++) {
            var a = anchors[i];
            if (/^javascript:/.test(a.href)) {
                console.warn("unsupported scheme: " + a.href);
                a.href = '#';
            }
            a.removeAttribute("target");
        }
        var imgs = talk.getElementsByTagName("img");
        talk.setAttribute("data-loading-images", imgs.length.toString());
        var handler;
        handler = function (e) {
            var img = e.target;
            var talk = img.parentElement;
            while (talk) {
                if (talk.classList.contains("talk")) {
                    talk.setAttribute("data-loading-images", (Math.max(0, (parseInt(talk.getAttribute("data-loading-images"), 10) - 1) || 0)).toString());
                    var ph = parseInt(talk.getAttribute("data-height"), 10);
                    var delta = talk.clientHeight - ph;
                    var b_1 = HOST();
                    if (b_1.scrollTop + b_1.clientHeight + Messages.IS_BOTTOM_MARGIN > b_1.scrollHeight - delta) {
                        b_1.scrollTop = b_1.scrollHeight - b_1.clientHeight;
                    }
                    else if (talk.offsetTop < b_1.scrollTop) {
                        b_1.scrollTop += delta;
                    }
                    talk.setAttribute("data-height", talk.clientHeight.toString());
                    break;
                }
                else if (/^error$/i.test(e.type) && talk.classList.contains("embed_media")) {
                    var tp = talk.parentElement;
                    talk.remove();
                    if (tp.children.length === 0) {
                        tp.remove();
                    }
                    break;
                }
                else if (/^error$/i.test(e.type) && talk.classList.contains("thumb")) {
                    talk.remove();
                }
                talk = talk.parentElement;
            }
            img.removeEventListener("load", handler);
            img.removeEventListener("error", handler);
            _reportVisibilities();
        };
        for (var i = 0; i < imgs.length; i++) {
            imgs[i].addEventListener("load", handler);
            imgs[i].addEventListener("error", handler);
        }
    }
    function _talkByIdempotentKey(idempotentKey) {
        return document.querySelector('div.talk[data-idempotent-key=\"' + idempotentKey + "\"]");
    }
    var _visibleIds;
    var _lastTimer;
    var _lastScrollHeight;
    var _lastScrollTop;
    function _reportVisibilities() {
        var b = HOST();
        _lastScrollTop = b.scrollTop;
        _lastScrollHeight = b.scrollHeight;
        if (_lastTimer) {
            clearTimeout(_lastTimer);
        }
        _lastTimer = setTimeout(function () {
            _lastTimer = null;
            var b = HOST();
            if (_lastScrollTop != b.scrollTop || _lastScrollHeight != b.scrollHeight) {
                _reportVisibilities();
            }
            else {
                _reportVisibilitiesCore();
            }
        }, 250);
    }
    function _reportVisibilitiesCore() {
        var b = HOST();
        var talks = b.children;
        var ids = "";
        for (var i = 0; i < talks.length; i++) {
            var talk = talks[i];
            if (b.scrollTop < talk.offsetTop + talk.clientHeight
                && talk.offsetTop < b.scrollTop + b.clientHeight) {
                var id = talk.getAttribute("data-message-id") || talk.getAttribute("data-idempotent-key");
                if (ids.length > 0) {
                    ids += "," + id;
                }
                else {
                    ids = id;
                }
            }
            else if (ids.length > 0) {
                break;
            }
        }
        if (_visibleIds !== ids) {
            location.href = "http://kokoro.io/client/control?event=visibility&ids=" + ids;
            _visibleIds = ids;
            if (Messages.LOG_VIEWPORT) {
                console.log("visibility changed: scrollTop: " + b.scrollTop
                    + (", clientHeight: " + b.clientHeight)
                    + (", lastElementChild.offsetTop: " + (b.lastElementChild ? b.lastElementChild.offsetTop : -1))
                    + (", lastElementChild.clientHeight: " + (b.lastElementChild ? b.lastElementChild.clientHeight : -1)));
            }
        }
    }
    document.addEventListener("DOMContentLoaded", function () {
        var windowWidth = window.innerWidth;
        window.addEventListener("resize", function () {
            if (window.innerWidth == windowWidth) {
                return;
            }
            windowWidth = window.innerWidth;
            var b = HOST();
            var talks = b.children;
            for (var i = 0; i < talks.length; i++) {
                var talk = talks[i];
                talk.setAttribute("data-height", talk.clientHeight.toString());
            }
            _reportVisibilities();
        });
        document.addEventListener("scroll", function () {
            var b = HOST();
            var talks = b.children;
            for (var i = 0; i < talks.length; i++) {
                var talk = talks[i];
                var hidden = (talk.offsetTop + talk.clientHeight + Messages.HIDE_CONTENT_MARGIN < b.scrollTop
                    || b.scrollTop + b.clientHeight < talk.offsetTop - Messages.HIDE_CONTENT_MARGIN)
                    && !(parseInt(talk.getAttribute("data-loading-images"), 10) > 0);
                if (hidden) {
                    if (!talk.classList.contains("hidden")) {
                        talk.style.height = talk.clientHeight.toString() + 'px';
                        talk.classList.add("hidden");
                    }
                }
                else {
                    if (talk.classList.contains("hidden")) {
                        talk.style.height = null;
                        talk.classList.remove("hidden");
                    }
                }
            }
            _reportVisibilities();
            if (b.scrollHeight < b.clientHeight) {
                return;
            }
            if (b.scrollTop < Messages.LOAD_OLDER_MARGIN) {
                if (!_isUpdating) {
                    console.log("Loading older messages.");
                    location.href = "http://kokoro.io/client/control?event=prepend&count=" + b.children.length;
                }
            }
            else {
                var fromBottom = b.scrollHeight - b.scrollTop - b.clientHeight;
                if (fromBottom < 4 || (_hasUnread && fromBottom < Messages.LOAD_NEWER_MARGIN)) {
                    if (!_isUpdating) {
                        console.log("Loading newer messages.");
                        location.href = "http://kokoro.io/client/control?event=append&count=" + b.children.length;
                    }
                }
            }
        });
        var mouseDownStart = null;
        var hovered;
        document.body.addEventListener("mousedown", function (e) {
            if (e.button === 0) {
                if (hovered) {
                    hovered.classList.remove("message-hover");
                }
                hovered = e.currentTarget;
                while (hovered && !hovered.classList.contains("talk")) {
                    hovered = hovered.parentElement;
                }
                if (hovered) {
                    hovered.classList.add("message-hover");
                }
                var b = document.body;
                if (b.scrollTop + b.clientHeight + 4 > b.scrollHeight) {
                    mouseDownStart = new Date().getTime();
                    setTimeout(function () {
                        if (mouseDownStart !== null
                            && mouseDownStart + 800 < new Date().getTime()) {
                            if (!_isUpdating) {
                                console.log("Loading newer messages.");
                                location.href = "http://kokoro.io/client/control?event=append&count=" + HOST().children.length;
                            }
                        }
                        mouseDownStart = null;
                    }, 1000);
                    return;
                }
            }
            mouseDownStart = null;
        });
        document.body.addEventListener("mouseup", function (e) {
            mouseDownStart = null;
        });
        document.body.addEventListener("mousemove", function (e) {
            if (hovered) {
                hovered.classList.remove("message-hover");
                hovered = null;
            }
        });
        document.body.addEventListener("wheel", function (e) {
            if (e.ctrlKey) {
                e.preventDefault();
                return;
            }
        });
        location.href = "http://kokoro.io/client/control?event=loaded";
    });
})(Messages || (Messages = {}));
</script>
    </head>
    <body />
</html>